# baseURI: http://semantic-machines.com/veda/veda-admin
# imports: http://semantic-machines.com/veda/veda-schema
# imports: http://www.w3.org/1999/02/22-rdf-syntax-ns#
# imports: http://www.w3.org/2000/01/rdf-schema#
# imports: http://www.w3.org/2002/07/owl

# c14n-version: 3
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix v-a: <http://semantic-machines.com/veda/veda-admin/> .
@prefix v-s: <http://semantic-machines.com/veda/veda-schema/> .
@prefix v-ui: <http://semantic-machines.com/veda/veda-ui/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

<http://semantic-machines.com/veda/veda-admin>
  rdf:type owl:Ontology ;
  rdfs:label "Veda system administrator ontology"@en ;
  rdfs:label "Онтология администратора системы Веда"@ru ;
  owl:imports <http://semantic-machines.com/veda/veda-schema> ;
  owl:imports rdf: ;
  owl:imports rdfs: ;
  owl:imports <http://www.w3.org/2002/07/owl> ;
  owl:versionInfo "1.0" ;
.
v-a:SuperAdmin
  rdf:type v-s:Group ;
  rdfs:label "Super admin"@en ;
  rdfs:label "Супер админ"@ru ;
.
v-a:ReadUser
  rdf:type v-s:Group ;
  rdfs:label "Read User"@en ;
  rdfs:label "Пользователи имеющие право на чтение"@ru ;
.
v-a:ReadResGroup
  rdf:type v-s:Group ;
  rdfs:label "Resource group to read"@en ;
  rdfs:label "Группа ресурсов для чтения"@ru ;
.
v-a:Membership_rl1
  rdf:type v-s:Membership ;
  v-s:memberOf v-a:ReadResGroup ;
  v-s:resource v-ui:EN ;
  rdfs:label "Membership_rl1"@en ;
  rdfs:label "Членство_rl1"@ru ;
.
v-a:Membership_rl2
  rdf:type v-s:Membership ;
  v-s:memberOf v-a:ReadResGroup ;
  v-s:resource v-ui:RU ;
  rdfs:label "Membership_rl2"@en ;
  rdfs:label "Членство_rl2"@ru ;
.
v-a:VedaSystem
  rdf:type v-s:Person ;
  v-s:actualVersion v-a:VedaSystem ;
  v-s:birthday "2014-03-05"^^xsd:dateTime ;
  v-s:firstName "Veda"@en ;
  v-s:firstName "Веда"@ru ;
  v-s:hasAccount v-a:VedaSystemAccount ;
  v-s:lastName "System"@en ;
  v-s:lastName "Система"@ru ;
  rdfs:label "Veda System"@en ;
  rdfs:label "Система Веда"@ru ;
.
v-a:Permission_rr
  rdf:type v-s:PermissionStatement ;
  v-s:author v-a:VedaSystem ;
  v-s:canRead "true"^^xsd:boolean ;
  v-s:created "2014-01-30T16:45:33"^^xsd:dateTime ;
  v-s:permissionObject v-a:ReadResGroup ;
  v-s:permissionSubject v-a:ReadUser ;
  v-s:published "2014-01-30T16:45:33"^^xsd:dateTime ;
  v-s:startTime "2014-01-30T16:45:33"^^xsd:dateTime ;
  rdfs:label "Permissions record rr"@en ;
  rdfs:label "Запись о выдаче прав rr"@ru ;
.
v-a:Mandate_1
  rdf:type v-s:Mandate ;
  v-s:author v-a:VedaSystemAccount ;
  v-s:created "2014-01-31T15:28:18"^^xsd:dateTime ;
  v-s:published "2014-01-31T15:28:18"^^xsd:dateTime ;
  v-s:script """
var ticket = '';
var ff = get_property_chain (ticket, '$document', 'v-s:author', 'v-s:employee');
if (ff)
{
    var employee_uri = getUri (ff['field']);
    var first_doc = ff['first'];
    if (first_doc)
    {
	var doc_uri = first_doc['@'];	
    if (employee_uri)
    {
	var new_permission = 
	{
        '@' : guid (), 
        'rdf:type' : [{data: 'v-s:PermissionStatement', type : _Uri}],
        'v-s:canDelete' : [{data: true, type : _Bool}],
        'v-s:canRead' : [{data: true, type : _Bool}],
        'v-s:canUpdate' : [{data: true, type : _Bool}],
        'v-s:permissionObject' : [{data: doc_uri, type : _Uri}],
        'v-s:permissionSubject'  : [{data: employee_uri, type : _Uri}]
	};
	put_individual (ticket, new_permission);
    }
    }
}
""" ;
  rdfs:comment "скрипт автоматической выдачи прав авторам"@ru ;
  rdfs:label "Mandate_1"@en ;
  rdfs:label "Мандат_1"@ru ;
.
v-a:Mandate_2
  rdf:type v-s:Mandate ;
  v-s:author v-a:VedaSystemAccount ;
  v-s:created "2014-01-31T15:28:18"^^xsd:dateTime ;
  v-s:published "2014-01-31T15:28:18"^^xsd:dateTime ;
  v-s:script """
var ticket = '';
        var doc;
        ff = get_individual (ticket, '$document');
if (ff)
{
// print ('@@1 =', toJson (ff));
    var type = ff['rdf:type'];
    if (type)
    {
	if (type[0].data == 'v-s:Department' || type[0].data == 'v-s:Position' || 
	    type[0].data == 'v-s:Appointment' || type[0].data == 'v-s:Person')
	{
	    var deleted = ff['v-s:deleted'];
	    var doc_uri = ff['@'];	
	    var new_membership = 
	    {
    	    '@' : guid (), 
    	    'rdf:type' : [{data: 'v-s:Membership', type : _Uri}],
    	    'v-s:memberOf' : [{data: 'v-a:ReadResGroup', type : _Uri}],
    	    'v-s:resource'  : [{data: doc_uri, type : _Uri}],
    	    'rdfs:comment'  : [{data: "выдан v-a:Mandate_2", type : _String}]
	    };

	    if (deleted && deleted[0].data == true)
	    {
		//print ('IS DELETED');
		new_membership['v-s:deleted'] = deleted;
	    }
	    var res = put_individual (ticket, new_membership);
	    if (res != 200 && res != 1022)
		print ('res=', res, ' @@1 =', toJson (new_membership));		
	}
    }
}
""" ;
  rdfs:comment "скрипт автоматической выдачи прав на чтение для оргструктуры + перенос атрибута v-s:deleted"@ru ;
  rdfs:label "Mandate_2"@en ;
  rdfs:label "Мандат_2"@ru ;
.


v-a:Mandate_3
  rdf:type v-s:Mandate ;
  v-s:author v-a:VedaSystemAccount ;
  v-s:created "2014-01-31T15:28:18"^^xsd:dateTime ;
  v-s:published "2014-01-31T15:28:18"^^xsd:dateTime ;
  v-s:script """
var ticket = '';
        var doc;
        ff = get_individual (ticket, '$document');
if (ff)
{
    var type = ff['rdf:type'];
    if (type)
    {
	var prefix = type[0].data.split (':', 1);
	if (prefix == 'owl' || prefix == 'rdf' || 
	    prefix == 'rdfs')
	{
	    var doc_uri = ff['@'];	
	    var new_membership = 
	    {
    	    '@' : guid (), 
    	    'rdf:type' : [{data: 'v-s:Membership', type : _Uri}],
    	    'v-s:memberOf' : [{data: 'v-a:ReadResGroup', type : _Uri}],
    	    'v-s:resource'  : [{data: doc_uri, type : _Uri}],
    	    'rdfs:comment'  : [{data: "выдан v-a:Mandate_3", type : _String}]
	    };

	    put_individual (ticket, new_membership);
	}
    }
}
""" ;
  rdfs:comment "скрипт автоматической выдачи прав на чтение для всех онтологий"@ru ;
  rdfs:label "Mandate_3"@en ;
  rdfs:label "Мандат_3"@ru ;
.
v-a:VedaSystemAccount
  v-s:author v-a:VedaSystem ;
  rdf:type v-s:Account ;
  v-s:login "veda"^^xsd:string ;
  v-s:mailbox "veda@semantic-machines.com"^^xsd:string ;
  v-s:owner v-a:VedaSystem ;
  v-s:password "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3"^^xsd:string ;
  rdfs:label "Veda System Account"@en ;
  rdfs:label "Учетная запись системы Веда"@ru ;
.
v-a:Membership_1
  rdf:type v-s:Membership ;
  v-s:memberOf v-a:SuperAdmin ;
  v-s:resource v-a:VedaSystem ;
  rdfs:label "v-a:Membership_1"@en ;
  rdfs:label "v-a:Членство_1"@ru ;
.
