<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8"/>
		<title>Veda</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description" content=""/>
		<meta name="author" content=""/>
		<link href="/css/veda.min.css" rel="stylesheet"/>
		<style> 
			.pass:before { 
				content: "PASS: "; 
				color:  green; 
				font-weight: bold; 
			} 
			.fail:before { 
				content: "FAIL: "; 
				color: red; 
				font-weight: bold; 
			} 
		</style> 
		<!-- Do not cache tests page -->
		<meta http-equiv="pragma" content="no-cache" />
		<meta http-equiv="cache-control" content="no-cache" />
	</head>
	<body style="padding: 0px 0px 30px;">

		<nav role="navigation" class="navbar navbar-inverse" id="navigation">
			<div class="container-fluid">
				<a href="/" class="btn btn-info navbar-btn navbar-left">VEDA</a>
				<ul class="nav navbar-nav navbar-left">
					<li>
						<a href="/view_classes/" title="Classes">Классы / Classes</a>
					</li>
					<li>
						<a href="/search/" title="Search">Поиск / Search</a>
					</li>
					<li>
						<a href="/tests" title="Search">Тесты / Tests</a>
					</li>
				</ul>
				<a href="/logout" class="btn btn-xs btn-danger navbar-btn navbar-right">
					<i class="glyphicon glyphicon-log-out"></i>
				</a>
				<p class="navbar-text navbar-right">
					Signed in as 
					<a href="#" class="navbar-link">Roman Karpov</a>
				</p>
				<div data-toggle="buttons" class="navbar-right btn-group">
					<label id="ru-label" class="btn btn-xs btn-info navbar-btn active">
						<input id="ru" type="radio"/>
						Ru
					</label>
					<label id="en-label" class="btn btn-xs btn-info navbar-btn">
						<input id="ru" type="radio"/>
						En
					</label>
				</div>
			</div>
		</nav>
		
		<div class="container-fluid" id="tests">
			<br />
			<ul id="output"></ol>
		</div>

		<br />
		<nav style="min-height:20px;" class="navbar navbar-fixed-bottom" id="copyright">
			<footer>
				<div class="container-fluid" style="background-color: white; border-top: 1px solid lightgray">
					<a href="http://www.semantic-machines.com" title="Официальный сайт компании">&copy; "Смысловые машины", ООО.</a>
					Лицензия / License
					<a alt="GNU General Public License version 3 official text" href="http://www.gnu.org/licenses/gpl.html">GPLv3.</a>
				</div>
			</footer>
		</nav>

		<!-- Javascript placed at the end of the document so the pages load faster -->
		
		<!-- Utils & UI -->
		<script src="/js/browser/jquery.js"></script>
		<script src="/js/browser/bootstrap.min.js"></script>
		<script src="/js/browser/cookie.js"></script>

		<!-- Veda browser & server -->
		<script src="/js/common/riot.js"></script>
		<script src="/js/common/util.js"></script>
		<script src="/js/common/veda_console_model.js"></script>

		<!-- Veda browser only -->
		<script src="/js/browser/veda_backend.js"></script>
		<script src="/js/browser/veda_console_presenter.js"></script>
		
		<script> 
			var output = document.getElementById("output"); 
			function assert( outcome, description ) { 
				var li = document.createElement("li"); 
				li.className = outcome ? "pass" : "fail"; 
				li.appendChild( document.createTextNode( description ) ); 

				output.appendChild(li); 
			}; 
		</script>

		<!-- TESTS -->

		<script>
			(function() { var description = "1. Get individual 'owl:'";
			
				var ticket = getCookie("ticket");
				get_individual(ticket, "owl:", function(data){
					assert (
						data["@"] == "owl:"
					,description);
				});

			})();
		</script>

		<script>
			(function() { var description = "2. Query '@' == 'owl:' ++ Get individual 'owl:'";
			
				var ticket = getCookie('ticket');
				query(ticket, "owl:", function(data){
					assert (
						data.indexOf("owl:") >= 0
					,description);
				});

			})();
		</script>

		<script>
			(function() { var description = "3. Individual store user1 and no read user2";
		
				var ticket_user1 = authenticate('bushenevv', 'a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3');
				if (ticket_user1.id == "")
				{
				    assert (false, description + " #1");
				    return;	
				}	

				var ticket_user2 = authenticate('BychinA', 'a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3');
				if (ticket_user2.id == "")
				{
				    assert (false, description + " #2");
				    return;	
				}	

				var new_test_doc1_uri = "test3:" + guid ();
				var new_test_doc1 =
				  {
				     '@' : new_test_doc1_uri,
				     'rdf:type' : [{data: 'veda-schema:document', type : 'Uri'}],
				     'veda-schema:author' : [{data: 'mondi-data:ValeriyBushenev-Programmer1', type : 'Uri'}],
				     'veda-schema:test_field'  : [{data:  'test data', type : 'String'}]
				  };

				put_individual(ticket_user1.id, new_test_doc1, true);

				var read_individual = get_individual(ticket_user1.id, new_test_doc1_uri);	    
				if (compare (new_test_doc1, read_individual) == false)
				{	
				    assert (false, description + " #3");
				    return;	
				}	

				read_individual = get_individual(ticket_user2.id, new_test_doc1_uri);	    
				assert (compare (new_test_doc1, read_individual) == false, description);
				     	
			})();
		</script>

		<script>
			(function() { var description = "4. Individual store user1, add right and read user2";
		
				var ticket_user1 = authenticate('bushenevv', 'a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3');
				if (ticket_user1.id == "")
				{
				    assert (false, description + " #1");
				    return;	
				}	

				var ticket_user2 = authenticate('BychinA', 'a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3');
				if (ticket_user2.id == "")
				{
				    assert (false, description + " #2");
				    return;	
				}	

				var new_test_doc1_uri = guid ();
				var new_test_doc1 =
				  {
				     '@' : new_test_doc1_uri,
				     'rdf:type' : [{data: 'veda-schema:document', type : 'Uri'}],
				     'veda-schema:author' : [{data: 'mondi-data:ValeriyBushenev-Programmer1', type : 'Uri'}],
				     'veda-schema:test_field'  : [{data:  'test data', type : 'String'}]
				  };

				put_individual(ticket_user1.id, new_test_doc1, true);

				var read_individual = get_individual(ticket_user2.id, new_test_doc1_uri);	    
				if (compare (new_test_doc1, read_individual) == true)
				{
				    assert (false, description + " #3");
				    return;	
				}	

				read_individual = get_individual(ticket_user1.id, new_test_doc1_uri);	    
				if (compare (new_test_doc1, read_individual) == false)
				{
				    assert (false, description + " #4");
				    return;	
				}	

                                var new_permission =
                                  {
                                     '@' : guid (),
                                     'rdf:type' : [{data: 'veda-schema:PermissionStatement', type : 'Uri'}],
                                     'veda-schema:canRead' : [{data: 'true', type : 'String'}],
                                     'veda-schema:permissionObject' : [{data: new_test_doc1_uri, type : 'Uri'}],
                                     'veda-schema:permissionSubject'  : [{data:  ticket_user2.user_uri, type : 'Uri'}]
                                  };
                                put_individual(ticket_user1.id, new_permission, true);

				var read_individual = get_individual(ticket_user2.id, new_test_doc1_uri);	    
				assert (compare (new_test_doc1, read_individual), description);
				     	
			})();
		</script>

		<script>
			(function() { var description = "5. Individual store user1 and read admin";
		
				var ticket_user1 = authenticate('bushenevv', 'a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3');
				if (ticket_user1.id == "")
				{
				    assert (false, description + " #1");
				    return;	
				}	

				var admin_ticket = getCookie('ticket');

				var new_test_doc1_uri = guid ();
				var new_test_doc1 =
				  {
				     '@' : new_test_doc1_uri,
				     'rdf:type' : [{data: 'veda-schema:document', type : 'Uri'}],
				     'veda-schema:author' : [{data: 'mondi-data:ValeriyBushenev-Programmer1', type : 'Uri'}],
				     'veda-schema:test_field'  : [{data:  'test data', type : 'String'}]
				  };

				put_individual(ticket_user1.id, new_test_doc1, true);

				var read_individual = get_individual(ticket_user1.id, new_test_doc1_uri);	    

				if (compare (new_test_doc1, read_individual) == false)
				{
				    assert (false, description + " #2");
				    return;	
				}	

				read_individual = get_individual(admin_ticket, new_test_doc1_uri);	    
				assert (compare (new_test_doc1, read_individual), description);
				     	
			})();
		</script>


		<script>
			(function() { var description = "6. Individual store and read";
		
				var ticket = getCookie('ticket');
				var new_test_doc1_uri = guid ();
				var new_test_doc1 =
				  {
				     '@' : new_test_doc1_uri,
				     'rdf:type' : [{data: 'veda-schema:PermissionStatement1', type : 'Uri'}],
				     'veda-schema:canDelete' : [{data: 'true', type : 'String'}],
				     'veda-schema:canRead' : [{data: 'true', type : 'String'}],
				     'veda-schema:canUpdate' : [{data: 'true', type : 'String'}],
				     'veda-schema:permissionObject' : [{data: 'individual_1', type : 'Uri'}],
				     'veda-schema:permissionSubject'  : [{data:  'individual_2', type : 'Uri'}]
				  };

				put_individual(ticket, new_test_doc1, true);

				var read_individual = get_individual(ticket, new_test_doc1_uri);

				assert (compare (new_test_doc1, read_individual), description); 	
			})();
		</script>

		<script>
			function test11(type, description, passed) { 
				var ticket = getCookie('ticket');
				
				var permissionSubject = guid ();
				var permissionObject = guid ();

				var new_test_doc1_uri = guid ();
				var new_test_doc1 =
				  {
				     '@' : new_test_doc1_uri,
				     'rdf:type' : [{data: type, type : 'Uri'}],
				     'veda-schema:canDelete' : [{data: 'true', type : 'String'}],
				     'veda-schema:canRead' : [{data: 'true', type : 'String'}],
				     'veda-schema:canUpdate' : [{data: 'true', type : 'String'}],
				     'veda-schema:permissionObject' : [{data: permissionObject, type : 'Uri'}],
				     'veda-schema:permissionSubject'  : [{data: permissionSubject, type : 'Uri'}]
				  };

				put_individual(ticket, new_test_doc1, true);

				var read_individual = get_individual(ticket, new_test_doc1_uri);
				if (compare (new_test_doc1, read_individual) == false)
				{
				 	assert (false, description + " : #1");				
				    return;	
				}	
				
				var new_test_doc2 = new_test_doc1;
				new_test_doc2_uri = guid ();
				new_test_doc2['@'] = new_test_doc2_uri;
			     	new_test_doc2['veda-schema:canRead'] = [{data: 'false', type : 'String'}],
				put_individual(ticket, new_test_doc2, true);

				read_individual = get_individual(ticket, new_test_doc2_uri);
				if (compare (new_test_doc2, read_individual) == false)
				{
				 	assert (false, description + " : #2");				
				    return;	
				}	
					
				var new_test_doc3 = new_test_doc2;
				new_test_doc3_uri = guid ();
				new_test_doc3['@'] = new_test_doc3_uri;
			     	new_test_doc3['veda-schema:canRead'] = [{data: 'true', type : 'String'}],
				put_individual(ticket, new_test_doc3, true);

				read_individual = get_individual(ticket, new_test_doc3_uri);
				assert (((read_individual['@'] == new_test_doc3_uri) == passed), description);
			};

			(function() { 
				test11 ("veda-schema:PermissionStatement", "7. Individual of [veda-schema:PermissionStatement] store 3 and read 2", false);
				test11 ("veda-schema:NoPermissionStatement", "8. Individual of [veda-schema:NoPermissionStatement] store 3 and read 3", true);
			})();
		    

		</script>

		<script>
			function test12(type, description, passed) { 
				var ticket = getCookie('ticket');
				
				var memberOf = guid ();
				var resources = guid ();

				var new_test_doc1_uri = guid ();
				var new_test_doc1 =
				  {
				     '@' : new_test_doc1_uri,
				     'rdf:type' : [{data: type, type : 'Uri'}],
				     'veda-schema:memberOf' : [{data: memberOf, type : 'Uri'}],
				     'veda-schema:resource'  : [{data: resources, type : 'Uri'}]
				  };

				put_individual(ticket, new_test_doc1, true);

				var read_individual = get_individual(ticket, new_test_doc1_uri);
				if (compare (new_test_doc1, read_individual) == false)
				{
				 	assert (false, description + " : #1");				
				    return;	
				}	
				
				var new_test_doc2 = new_test_doc1;
				new_test_doc2_uri = guid ();
				new_test_doc2['@'] = new_test_doc2_uri;
			        new_test_doc2['veda-schema:memberOf'] = [{data: guid (), type : 'Uri'}],
				put_individual(ticket, new_test_doc2, true);

				read_individual = get_individual(ticket, new_test_doc2_uri);
				if (compare (new_test_doc2, read_individual) == false)
				{
				 	assert (false, description + " : #2");				
				    return;	
				}	
					
				var new_test_doc3 = new_test_doc2;
				new_test_doc3_uri = guid ();
				new_test_doc3['@'] = new_test_doc3_uri;
			        new_test_doc3['veda-schema:memberOf'] = [{data: memberOf, type : 'Uri'}],
				put_individual(ticket, new_test_doc3, true);

				read_individual = get_individual(ticket, new_test_doc3_uri);
				assert (((read_individual['@'] == new_test_doc3_uri) == passed), description);
			};

			(function() { 
				test12 ("veda-schema:Membership", "9. Individual of [veda-schema:Membership] store 3 and read 2", false);
				test12 ("veda-schema:NoMembership", "10. Individual of [veda-schema:NoMembership] store 3 and read 3", true);
			})();
		    

		</script>

	</body>
</html>
